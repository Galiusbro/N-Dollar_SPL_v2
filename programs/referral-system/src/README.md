# Referral System - Реструктуризированный проект

## Структура проекта

```
referral_system/
├── lib.rs             # Точка входа программы, объявление модулей и инструкций
├── constants.rs       # Константы для проекта
├── errors.rs          # Определения ошибок программы
├── state.rs           # Определения состояний (аккаунтов)
├── contexts/          # Контексты инструкций
│   ├── mod.rs         # Экспорт всех контекстов
│   ├── initialize.rs  # Контекст для инициализации
│   ├── register.rs    # Контекст для регистрации реферала
│   ├── reward.rs      # Контекст для начисления вознаграждений
│   └── status.rs      # Контекст для проверки статуса
├── instructions/      # Реализация инструкций
│   ├── mod.rs         # Экспорт всех инструкций
│   ├── initialize.rs  # Инструкция инициализации системы
│   ├── register.rs    # Инструкция регистрации по реферальной ссылке
│   ├── reward.rs      # Инструкция начисления вознаграждений
│   ├── status.rs      # Инструкция проверки статуса реферальной ссылки
│   └── utils.rs       # Вспомогательные функции
```

## Описание модулей

### 1. `lib.rs`

Основной файл программы, содержит объявление ID программы, подключение модулей и определение инструкций (entrypoints).

### 2. `constants.rs`

Содержит все константы, используемые в программе:

- Процент вознаграждения для реферреров
- Семена для генерации PDA

### 3. `errors.rs`

Определяет все возможные ошибки программы для реферальной системы.

### 4. `state.rs`

Содержит определения структур данных:

- `ReferralSystem` - Общая информация о реферальной системе
- `ReferralData` - Данные о конкретной реферальной ссылке
- `UserData` - Данные о пользователе в реферальной системе

### 5. `contexts/`

Директория с контекстами (аккаунтами) для каждой инструкции:

- `initialize.rs`: Контекст для инициализации реферальной системы
- `register.rs`: Контекст для регистрации пользователя по реферальной ссылке
- `reward.rs`: Контекст для начисления вознаграждений
- `status.rs`: Контекст для проверки статуса реферальной ссылки

### 6. `instructions/`

Директория с реализациями инструкций:

- `initialize.rs`: Логика инициализации реферальной системы
- `register.rs`: Логика регистрации пользователя по реферальной ссылке
- `reward.rs`: Логика начисления вознаграждений пользователю и реферреру
- `status.rs`: Логика проверки статуса реферальной ссылки
- `utils.rs`: Вспомогательные функции для проверок и расчетов

## Выполненная реструктуризация

1. Разделены логические блоки:
   - Состояния и структуры данных
   - Контексты инструкций
   - Реализация инструкций
   - Константы и ошибки
2. Улучшена организация кода:
   - Каждый модуль отвечает за конкретный аспект программы
   - Уменьшен размер отдельных файлов
   - Улучшена навигация по коду
   - Вынесены литералы в константы
3. Выделены вспомогательные функции:

   - Проверка токенов и их владельцев
   - Вычисление вознаграждений
   - Проверка регистрации

4. Сохранена вся функциональность:
   - Все инструкции работают так же, как и раньше
   - Логика осталась неизменной
