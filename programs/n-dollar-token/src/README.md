# N-Dollar Token - Реструктуризированный проект

## Структура проекта

```
n_dollar_token/
├── lib.rs             # Точка входа программы, объявление модулей и инструкций
├── constants.rs       # Константы для проекта
├── errors.rs          # Определения ошибок программы
├── state.rs           # Определения состояний (аккаунтов)
├── contexts/          # Контексты инструкций
│   ├── mod.rs         # Экспорт всех контекстов
│   ├── initialize.rs  # Контекст для инициализации
│   ├── mint.rs        # Контекст для минтинга
│   ├── admin.rs       # Контекст для админ-функций
│   └── metadata.rs    # Контекст для управления метаданными
├── instructions/      # Реализация инструкций
│   ├── mod.rs         # Экспорт всех инструкций
│   ├── initialize.rs  # Инструкция инициализации токена
│   ├── mint.rs        # Инструкция минтинга
│   ├── admin.rs       # Инструкции административных функций
│   ├── metadata.rs    # Инструкции управления метаданными
│   ├── auth.rs        # Инструкции для управления подписями
│   └── utils.rs       # Вспомогательные функции
```

## Описание модулей

### 1. `lib.rs`

Основной файл программы, содержит объявление ID программы, подключение модулей и определение инструкций (entrypoints).

### 2. `constants.rs`

Содержит все константы, используемые в программе:

- Временные интервалы для минтинга
- Параметры безопасности и мультиподписи
- Настройки токена
- Константы расписания поставки токенов
- Константы распределения токенов между администратором и пулом ликвидности

### 3. `errors.rs`

Определяет все возможные ошибки программы.

### 4. `state.rs`

Содержит определение структуры данных `AdminAccount`, которая хранит состояние токена N-Dollar, включая информацию о текущей неделе расписания.

### 5. `contexts/`

Директория с контекстами (аккаунтами) для каждой инструкции:

- `initialize.rs`: Контекст для инициализации токена N-Dollar с поддержкой распределения
- `mint.rs`: Контексты для минтинга новых токенов, включая специальный контекст для минтинга с распределением
- `admin.rs`: Контексты для административных функций
- `metadata.rs`: Контекст для обновления метаданных токена

### 6. `instructions/`

Директория с реализациями инструкций:

- `initialize.rs`: Логика инициализации токена N-Dollar с автоматическим минтом и распределением токенов
- `mint.rs`: Логика минтинга новых токенов согласно еженедельному расписанию и с автоматическим распределением
- `admin.rs`: Логика административных функций (сжигание, заморозка, разморозка)
- `metadata.rs`: Логика обновления метаданных токена
- `auth.rs`: Логика управления авторизованными подписантами
- `utils.rs`: Вспомогательные функции для проверки безопасности и авторизации

## Расписание минтинга N-Dollar

Программа автоматически управляет выпуском токенов согласно следующему расписанию:

1. При инициализации: 108,000,000 монет (автоматический минт с распределением)
2. Неделя 2: 54,000,000,000 монет
3. Неделя 3: 108,000,000,000 монет
4. Неделя 4: 369,000,000,000 монет

После 4-й недели расписание завершается, и дополнительный выпуск возможен только через ручное вызывание функции минтинга администратором.

## Распределение токенов

Все минтированные токены автоматически распределяются следующим образом:

- 90% направляются в пул ликвидности для обеспечения доступности токенов пользователям
- 10% остаются у администратора для операционных нужд

Это распределение обеспечивает:

1. Наличие достаточного количества токенов в пуле ликвидности для трейдинга
2. Резерв для администратора, необходимый для управления системой
3. Автоматизацию процесса без необходимости ручных переводов

## Доступ пользователей к токенам

Пользователи получают доступ к N-Dollar через пул ликвидности (liquidity-manager), который содержит пару N-Dollar/SOL. Они могут:

1. Покупать N-Dollar, отправляя SOL в пул
2. Продавать N-Dollar обратно в пул, получая SOL
3. Использовать N-Dollar для создания новых мемкоинов через программу Genesis

## Выполненная реструктуризация

1. Разделены логические блоки:
   - Состояния и структуры данных
   - Контексты инструкций
   - Реализация инструкций
   - Константы и ошибки
2. Улучшена организация кода:
   - Каждый модуль отвечает за конкретный аспект программы
   - Уменьшен размер отдельных файлов
   - Улучшена навигация по коду
   - Вынесены константы в отдельный модуль
3. Добавлена новая функциональность:
   - Автоматический минт начального количества (108 млн) при инициализации
   - Автоматическое определение количества токенов для минта по неделям
   - Отслеживание текущей недели в расписании выпуска
   - Автоматическое распределение токенов между администратором и пулом ликвидности

## Особенности безопасности

- Реализован механизм мультиподписи для чувствительных операций
- Добавлена защита от манипуляций временем при минтинге
- Ограничение на частоту минтинга (раз в неделю)
- Интеграция с admin_control для дополнительной авторизации
- Автоматическое управление расписанием поставки для предотвращения ошибок человеческого фактора
- Защита от арифметических ошибок при расчете распределения токенов
